# Railwayå¥åº·æ£€æŸ¥é—®é¢˜è§£å†³æ–¹æ¡ˆ

## ğŸ¯ é—®é¢˜æ€»ç»“

Railwayéƒ¨ç½²æ—¶å¥åº·æ£€æŸ¥å¤±è´¥ï¼Œæ˜¾ç¤º"service unavailable"é”™è¯¯ã€‚

## ğŸ”§ æ ¹æœ¬åŸå› åˆ†æ

1. **ç«¯å£ç»‘å®šé—®é¢˜**: æœåŠ¡å™¨ç»‘å®šåˆ°`localhost`è€Œä¸æ˜¯`0.0.0.0`
2. **å¯åŠ¨é€»è¾‘å¤æ‚**: å¤æ‚çš„å¥åº·æ£€æŸ¥æœåŠ¡å™¨é€»è¾‘å¯¼è‡´å¯åŠ¨å»¶è¿Ÿ
3. **å¥åº·æ£€æŸ¥é…ç½®**: è¶…æ—¶æ—¶é—´è¿‡é•¿ï¼Œæ£€æŸ¥é—´éš”ä¸åˆç†
4. **Dockeré…ç½®**: å¥åº·æ£€æŸ¥ä½¿ç”¨é”™è¯¯çš„ä¸»æœºåœ°å€

## âœ… å®æ–½çš„è§£å†³æ–¹æ¡ˆ

### 1. ç®€åŒ–æœåŠ¡å™¨å¯åŠ¨ (server.js)
```javascript
// ä¹‹å‰: å¤æ‚çš„å¥åº·æ£€æŸ¥æœåŠ¡å™¨é€»è¾‘
// ä¹‹å: ç›´æ¥å¯åŠ¨ç¼–è¯‘åçš„æœåŠ¡å™¨
require('./server/dist/index.js');
```

### 2. ä¼˜åŒ–å¥åº·æ£€æŸ¥ç«¯ç‚¹ (server/src/index.ts)
```typescript
// ç®€åŒ–å“åº”ï¼Œç¡®ä¿ç«‹å³å¯ç”¨
app.get('/health', (req, res) => {
  res.status(200).json({ 
    status: 'OK',
    timestamp: new Date().toISOString(),
    uptime: process.uptime(),
    env: env.nodeEnv,
    port: process.env.PORT || env.port || 5001
  });
});
```

### 3. ä¼˜åŒ–Railwayé…ç½® (railway.toml)
```toml
[deploy]
healthcheckPath = "/health"
healthcheckTimeout = 300  # ä»600å‡å°‘åˆ°300
startCommand = "npm start"
restartPolicyType = "on_failure"
restartPolicyMaxRetries = 3  # ä»5å‡å°‘åˆ°3

[env]
NODE_ENV = "production"
HOST = "0.0.0.0"  # ç¡®ä¿ç»‘å®šåˆ°æ‰€æœ‰æ¥å£
PORT = { default = "5001" }
```

### 4. ä¿®å¤Dockerå¥åº·æ£€æŸ¥ (Dockerfile)
```dockerfile
# ä¹‹å‰: CMD curl -f http://localhost:5001/health
# ä¹‹å: CMD curl -f http://0.0.0.0:5001/health
HEALTHCHECK --interval=30s --timeout=10s --start-period=30s --retries=3 \
  CMD curl -f http://0.0.0.0:5001/health || exit 1
```

### 5. ä¼˜åŒ–æ„å»ºé…ç½® (nixpacks.toml)
```toml
[variables]
NODE_ENV = 'production'
HOST = '0.0.0.0'  # ç¡®ä¿æ­£ç¡®çš„ä¸»æœºç»‘å®š
```

## ğŸ§ª æµ‹è¯•éªŒè¯

### æœ¬åœ°æµ‹è¯•ç»“æœ
```bash
âœ… æ„å»ºæµ‹è¯•: npm run build - æˆåŠŸ
âœ… æœåŠ¡å™¨å¯åŠ¨: node server.js - æˆåŠŸ  
âœ… å¥åº·æ£€æŸ¥: curl /health - æˆåŠŸ
âœ… å¥åº·æ£€æŸ¥è„šæœ¬: node railway-health-check.js - æˆåŠŸ
```

### å¥åº·æ£€æŸ¥å“åº”ç¤ºä¾‹
```json
{
  "status": "OK",
  "timestamp": "2025-05-28T23:14:41.373Z",
  "uptime": 8.647285041,
  "env": "production",
  "port": "5001"
}
```

## ğŸš€ éƒ¨ç½²æ­¥éª¤

1. **æäº¤æ›´æ”¹**: âœ… å·²å®Œæˆ
2. **æ¨é€åˆ°Railway**: 
   ```bash
   git push origin main
   ```
3. **ç›‘æ§éƒ¨ç½²**: æ£€æŸ¥Railwayæ§åˆ¶å°ä¸­çš„éƒ¨ç½²æ—¥å¿—
4. **éªŒè¯å¥åº·æ£€æŸ¥**: ç¡®è®¤æœåŠ¡çŠ¶æ€ä¸º"è¿è¡Œä¸­"

## ğŸ“Š é¢„æœŸæ”¹è¿›

- **å¯åŠ¨æ—¶é—´**: ä»60ç§’å‡å°‘åˆ°30ç§’ä»¥å†…
- **å¥åº·æ£€æŸ¥æˆåŠŸç‡**: ä»0%æå‡åˆ°100%
- **æœåŠ¡ç¨³å®šæ€§**: å‡å°‘é‡å¯æ¬¡æ•°
- **éƒ¨ç½²å¯é æ€§**: æé«˜éƒ¨ç½²æˆåŠŸç‡

## ğŸ” å…³é”®ä¿®å¤ç‚¹

1. **ç«‹å³ç»‘å®š**: æœåŠ¡å™¨ç«‹å³ç»‘å®šåˆ°`0.0.0.0:PORT`
2. **ç®€åŒ–å¯åŠ¨**: ç§»é™¤å¤æ‚çš„ä¸­é—´å±‚é€»è¾‘
3. **å¿«é€Ÿå“åº”**: å¥åº·æ£€æŸ¥ç«¯ç‚¹ç«‹å³å¯ç”¨
4. **æ­£ç¡®é…ç½®**: æ‰€æœ‰é…ç½®æ–‡ä»¶ä½¿ç”¨ä¸€è‡´çš„ä¸»æœºåœ°å€

## ğŸ“‹ éªŒè¯æ¸…å•

- [x] æœåŠ¡å™¨æ­£ç¡®ç»‘å®šåˆ°`0.0.0.0`
- [x] å¥åº·æ£€æŸ¥ç«¯ç‚¹ç«‹å³å¯ç”¨
- [x] å“åº”æ ¼å¼æ­£ç¡®
- [x] å¯åŠ¨æ—¶é—´ä¼˜åŒ–
- [x] é…ç½®æ–‡ä»¶ä¸€è‡´æ€§
- [x] æœ¬åœ°æµ‹è¯•é€šè¿‡
- [x] æ„å»ºéªŒè¯é€šè¿‡

## ğŸ‰ ç»“æœ

é€šè¿‡è¿™äº›ä¿®å¤ï¼ŒRailwayå¥åº·æ£€æŸ¥é—®é¢˜åº”è¯¥å¾—åˆ°å®Œå…¨è§£å†³ã€‚æœåŠ¡å™¨å°†èƒ½å¤Ÿï¼š

1. å¿«é€Ÿå¯åŠ¨å¹¶ç»‘å®šåˆ°æ­£ç¡®çš„åœ°å€
2. ç«‹å³å“åº”å¥åº·æ£€æŸ¥è¯·æ±‚
3. é€šè¿‡Railwayçš„å¥åº·æ£€æŸ¥éªŒè¯
4. ç¨³å®šè¿è¡Œåœ¨ç”Ÿäº§ç¯å¢ƒä¸­

---

**çŠ¶æ€**: âœ… è§£å†³æ–¹æ¡ˆå·²å®æ–½
**æµ‹è¯•çŠ¶æ€**: âœ… æ‰€æœ‰æœ¬åœ°æµ‹è¯•é€šè¿‡
**å‡†å¤‡çŠ¶æ€**: âœ… å‡†å¤‡éƒ¨ç½²åˆ°Railway 